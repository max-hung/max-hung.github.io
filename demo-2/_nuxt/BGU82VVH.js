import{_ as Q}from"./BQedWJ-q.js";import{_ as se}from"./D6zDn5aF.js";import{_ as oe}from"./BTRFR6JA.js";import{_ as ne}from"./Dj3sNFOI.js";import{_ as J}from"./BYDppEgj.js";import{_ as ae}from"./D6QJ4OJq.js";import{_ as le}from"./7NXfChhz.js";import{_ as me}from"./CXRWxkly.js";import{_ as ge}from"./BZGicdsi.js";import{_ as fe,a as ve}from"./DVUfWzqS.js";import{e as _e,b as ye,o as be}from"./dNQ8s3Hb.js";import{e as X,r as c,j as Z,c as q,o as x,b as n,m as he,w as l,u as s,a,t as S,l as z,d as m,F as G,s as $,h as ie,i as P,g as ee,f as te,B as ke}from"./B9-TfvVs.js";import{_ as Se}from"./Dfz9fpDd.js";import{_ as Ce}from"./B6lfat1k.js";import{f as H}from"./671f6edt.js";import{b as Ie,o as De,u as Ae}from"./CjDPWaWQ.js";import{a as xe}from"./oRgjyKKO.js";import{_ as Te,s as $e}from"./DDda62Zi.js";import{_ as Oe}from"./BfIm0v9O.js";import{_ as Ve}from"./BG8_437e.js";import{c as Pe}from"./zQboIAfo.js";import{f as we}from"./DkQxb8LZ.js";import{u as Be}from"./DiTTqIvM.js";import"./BssDOiam.js";const Ne={class:"md:grid grid-cols-2"},Ue={class:"p-2"},Fe={class:"preview-block"},Ee={class:"grid gap-y-2"},Me={class:"grid grid-cols-2 gap-4"},Le={class:"border-l p-2"},Ye={class:"grid gap-y-2"},je={class:"border rounded-lg overflow-auto"},Re={class:"overflow-auto col-span-2 max-h-[400px]"},Ke={class:"flex gap-2"},qe=X({__name:"OrderListEditOrder",props:{editOrder:{}},emits:["after-save"],setup(W,{emit:F}){const w=W,C={purchasedDate:"",shippingType:"",siteId:"",orderId:"",orderStatus:"",shippingAddress:"",shippingFirstName:"",shippingLastName:"",siteShippingAmount:"",discount:"",shippingPhone:"",shippingCountry:"",shippingCity:"",shippingRegion:"",shippingPostcode:"",shippingCompany:"",updatedAt:"",site:0,price:0,orderItems:[]},E=F,p=c(w.editOrder||{...C}),A=c(!1),T=f=>{A.value=!0,p.value={...f,orderItems:f.orderItems.map(o=>({...o,validate:!0}))}},u=Z(()=>p.value.orderItems.reduce((f,o)=>f+parseFloat(o.baseWeight),0).toFixed(2)||0),O=Z(()=>{const f=p.value.orderItems.reduce((D,v)=>{const y=parseFloat(v.price||"0");return D+(isNaN(y)?0:y)},0),o=parseFloat(p.value.siteShippingAmount)||0,_=parseFloat(p.value.discount)||0;return(f+o+_).toFixed(2)}),B=async(f,o)=>{if(!f)return!1;try{const _=p.value.orderItems.find(D=>D.id===o);return _&&f==_.sku&&(_.validate=!0),!0}catch(_){return $({title:"Error!",content:_},"danger"),!1}},I=async()=>{try{const{orderId:f,shippingPostcode:o,shippingRegion:_,shippingCity:D,shippingAddress:v,shippingPhone:y,shippingCompany:g,orderItems:t}=p.value,{data:b}=await _e({orderId:f,shippingPostcode:o,shippingRegion:_,shippingCompany:g,shippingCity:D,shippingAddress:v,shippingPhone:y,orderItems:t});b.errors.length&&$({title:"Warning !",content:b.errors},"danger"),b.message&&($({title:"Success !",content:b.message},"success"),A.value=!1,E("after-save"))}catch(f){$({title:"Error !",content:f},"danger")}};return(f,o)=>{const _=Q,D=J,v=le,y=ne,g=ae;return x(),q(G,null,[n(D,he({color:"info"},f.$attrs,{variant:"outline",onClick:o[0]||(o[0]=t=>T(w.editOrder))}),{icon:l(()=>[n(_,{class:"icon-edit"})]),_:1},16),n(g,{"backdrop-close":!1,visible:s(A),size:"xl",title:"Edit",onClose:o[7]||(o[7]=t=>A.value=!1),onSubmit:o[8]||(o[8]=t=>I())},{footer:l(()=>[a("div",Ke,[n(D,{color:"info",variant:"outline",type:"button",onClick:o[6]||(o[6]=t=>A.value=!1)},{default:l(()=>o[12]||(o[12]=[m(" Close ")])),_:1}),n(D,{color:"primary",type:"submit"},{default:l(()=>o[13]||(o[13]=[m(" Save Changes ")])),_:1})])]),default:l(()=>[a("div",Ne,[a("div",Ue,[a("div",Fe,[o[9]||(o[9]=a("div",null,"Order ID",-1)),a("div",null,S(s(p).orderId),1),o[10]||(o[10]=a("div",null,"Buyer Fullname",-1)),a("div",null,S(s(p).shippingLastName)+" "+S(s(p).shippingFirstName),1),o[11]||(o[11]=a("div",null,"Date",-1)),a("div",null,S(s(p).updatedAt),1)]),a("div",Ee,[n(v,{modelValue:s(p).shippingAddress,"onUpdate:modelValue":o[1]||(o[1]=t=>s(p).shippingAddress=t),label:"Shipping Address",required:""},null,8,["modelValue"]),a("div",Me,[n(v,{modelValue:s(p).shippingCity,"onUpdate:modelValue":o[2]||(o[2]=t=>s(p).shippingCity=t),label:"City",required:""},null,8,["modelValue"]),n(v,{modelValue:s(p).shippingCompany,"onUpdate:modelValue":o[3]||(o[3]=t=>s(p).shippingCompany=t),label:"Shipping Company"},null,8,["modelValue"])])])]),a("div",Le,[a("div",Ye,[a("div",je,[a("div",Re,[n(y,{headers:[{key:"sku",label:"SKU"},{key:"price",label:"Price(GBP)"},{key:"baseWeight",label:"Base Weight(kg)"},{key:"additionalTotalPrice",label:"Additional Total Price"}],items:s(p).orderItems},{sku:l(({item:t})=>[n(v,{ref:"inputRef","border-color":t.validate?"":"border-red-700",value:t.sku,validator:b=>B(b,t.id),"error-message":"SKU is not found.",required:""},null,8,["border-color","value","validator"])]),price:l(({item:t})=>[n(v,{modelValue:t.price,"onUpdate:modelValue":b=>t.price=b,step:"0.01",min:"0",type:"number",required:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["items"])])]),n(v,{modelValue:s(O),"onUpdate:modelValue":o[4]||(o[4]=t=>z(O)?O.value=t:null),disabled:"",label:"Total Amount(GBP)"},null,8,["modelValue"]),n(v,{modelValue:s(u),"onUpdate:modelValue":o[5]||(o[5]=t=>z(u)?u.value=t:null),disabled:"",label:"Base Total Weight(kg)"},null,8,["modelValue"])])])])]),_:1},8,["visible"])],64)}}}),We={class:"flex gap-2"},ze={class:"grid lg:grid-cols-3 gap-4"},Ge={class:"flex justify-between items-center"},He={class:"grid grid-cols-2 gap-1"},Qe=X({__name:"OrderListAdvanced",emits:["close","search"],setup(W,{expose:F,emit:w}){const C=we(new Date,"YYYY-MM-DD"),E=c(["",""]),p=c([C,C]),A=w,T=c(0),u=c({orderIds:[],skus:[],siteId:"",orderStatus:"",itemsStatus:"",purchasedDate:E.value,createdDate:p.value}),O=c([]),B=c([]),I=c([]),f=async()=>{const{data:g}=await $e();O.value=g==null?void 0:g.sites.map(t=>({text:t.siteCode,value:t.id}))},o=g=>Object.entries(g).map(([t,b])=>({text:H(b),value:b})),_=async()=>{try{const{data:g}=await Pe();if(!g)return;B.value=o(g.list.orderStatus),I.value=o(g.list.assignedStatus)}catch(g){$({title:"Error !",content:g},"danger")}},D=()=>{A("close")},v=()=>new Promise(g=>{setTimeout(()=>{g(A("search",u.value))},1e3)}),y=()=>{u.value={orderIds:[],skus:[],siteId:"",orderStatus:"",itemsStatus:"",purchasedDate:["",""],createdDate:[C,C]},T.value++};return ie(async()=>{await Promise.all([f(),_()])}),F({handleSearch:v}),(g,t)=>{const b=Q,N=se,j=fe,r=Te,e=Oe,d=J,M=Ve,U=oe;return x(),P(U,null,{header:l(()=>[a("div",We,[n(b,{class:"icon-filter"}),n(N,null,{default:l(()=>t[6]||(t[6]=[m("Advanced Search")])),_:1})])]),footer:l(()=>[a("div",Ge,[a("div",null,[n(d,{color:"link",class:"text-gray-950",onClick:y},{icon:l(()=>[n(b,{class:"icon-reload"})]),default:l(()=>[t[11]||(t[11]=m(" Reset "))]),_:1})]),a("div",He,[n(d,{color:"info",variant:"outline",onClick:D},{default:l(()=>t[12]||(t[12]=[m(" Close ")])),_:1}),n(M,{color:"dark",icon:"icon-zoom",disabled:!s(u).createdDate[0]||!s(u).createdDate[1],"loading-click":v},{default:l(()=>t[13]||(t[13]=[m(" Search ")])),_:1},8,["disabled"])])])]),default:l(()=>[a("div",ze,[n(j,{tags:s(u).orderIds,placeholder:"(comma or newline separated)",onOnTagsChanged:t[0]||(t[0]=h=>{s(u).orderIds=h.map(k=>k.trim())}),label:"Order ID"},null,8,["tags"]),n(j,{tags:s(u).skus,placeholder:"(comma or newline separated)",onOnTagsChanged:t[1]||(t[1]=h=>{s(u).skus=h.map(k=>k.trim())}),label:"SKU"},null,8,["tags"]),a("div",null,[t[7]||(t[7]=a("label",{class:"text-gray-500"},"Site",-1)),n(r,{modelValue:s(u).siteId,"onUpdate:modelValue":t[2]||(t[2]=h=>s(u).siteId=h),options:s(O)},null,8,["modelValue","options"])]),a("div",null,[t[8]||(t[8]=a("label",{class:"text-gray-500"},"Order Status",-1)),n(r,{modelValue:s(u).orderStatus,"onUpdate:modelValue":t[3]||(t[3]=h=>s(u).orderStatus=h),options:s(B)},null,8,["modelValue","options"])]),a("div",null,[t[9]||(t[9]=a("label",{class:"text-gray-500"},"Purchased Date",-1)),(x(),P(e,{key:s(T),modelValue:s(u).purchasedDate,"onUpdate:modelValue":t[4]||(t[4]=h=>s(u).purchasedDate=h),"value-type":"YYYY-MM-DD",class:"md:m-0 mb-2 min-w-full",range:""},null,8,["modelValue"]))]),a("div",null,[t[10]||(t[10]=a("label",{class:"text-gray-500"},"Created Date",-1)),(x(),P(e,{key:s(T),modelValue:s(u).createdDate,"onUpdate:modelValue":t[5]||(t[5]=h=>s(u).createdDate=h),"value-type":"YYYY-MM-DD",class:"md:m-0 mb-2 min-w-full",clearable:!1,range:""},null,8,["modelValue"]))])])]),_:1})}}}),Je={class:"mb-1"},Xe={class:"flex justify-start items-center gap-2"},Ze={class:"flex gap-2"},et={class:"flex gap-2"},tt={class:"flex md:flex-row flex-col md:justify-between justify-center items-center mb-5"},st={class:"grid grid-cols-2 gap-4"},ot={class:"flex flex-row gap-4"},nt={class:"flex gap-1"},at={class:"md:flex md:justify-between md:items-center"},lt={class:"md:flex md:justify-evenly grid lg:gap-6 lg:py-0 py-2"},it={class:"flex justify-center items-center gap-x-2"},rt=["src"],dt={class:"flex justify-center items-center gap-1"},Bt=X({__name:"order-list",setup(W){Be({title:"Order List"});const{getSiteImage:F}=Ae(),w=c([{key:"orderId",label:"Order ID"},{key:"sku",label:"SKU"},{key:"orderStatus",label:"Order Status"},{key:"fullName",label:"Buyer Fullname"},{key:"shippingAddress",label:"Shipping Address"},{key:"shippingCountry",label:"Country"},{key:"shippingCity",label:"City"},{key:"price",label:"Product Price"},{key:"additionalTotalPrice",label:"Addition Total Price"},{key:"additionalPriceDetail",label:"Additional Price Detail"},{key:"purchasedDate",label:"Purchased Date",sort:!0},{key:"updatedAt",label:"Updated Date",sort:!0}]),C=c([]),E=r=>r.flatMap(e=>e.orderItem.map(d=>({...d,orderItems:e.orderItem,disabledSelect:d.shippingType==="onTicket"||d.shippingType==="backOrder",disabled:e.orderStatus==="cancelled",site:e.siteId,orderStatus:e.orderStatus,shippingAddress:e.shippingAddress,shippingFirstName:e.shippingFirstName,shippingLastName:e.shippingLastName,siteShippingAmount:e.siteShippingAmount,shippingPhone:e.shippingPhone,discount:e.discount,shippingCountry:e.shippingCountry,shippingCity:e.shippingCity,shippingRegion:e.shippingRegion,shippingPostcode:e.shippingPostcode,shippingCompany:e.shippingCompany,purchasedDate:e.purchasedDate}))).reverse(),p=c(""),A=c(!1),T=c(0),u=c(),O=r=>{A.value=!0,T.value=r.orderId},B=async r=>{var e;try{await ye({orderIds:[r]})}catch(d){$({title:"Error !",content:d},"danger")}finally{(e=u.value)==null||e.handleSearch(),o()}},I=c([]),f=r=>{I.value=r},o=()=>{A.value=!1,T.value=0,_.value=!1,y.value=!1},_=c(!1),D=c([{label:"Order ID",key:"orderId"},{label:"SKU",key:"sku"}]),v=c(""),y=c(!1),g=async()=>{var e;if(y.value){ke("/shipment-ticket");return}if(I.value.length==0)return;const r=I.value.map(d=>d.id);try{const{data:d}=await xe({orderItemIds:r});if(!d.ticketNumber)return;if(v.value=d==null?void 0:d.ticketNumber,d!=null&&d.errors.length){$({title:"Error !",content:d==null?void 0:d.errors},"danger"),o();return}v.value&&(y.value=!0)}catch(d){$({title:"Error !",content:d},"danger")}finally{(e=u.value)==null||e.handleSearch(),I.value=[]}},t=c(!1),b=()=>{t.value=!t.value,C.value=C.value.map(r=>({...r,selected:t.value&&!r.disabled&&!r.disabledSelect})),I.value=t.value?C.value.filter(r=>!r.disabled&&!r.disabledSelect):[]},N=c(!1),j=async r=>{const{itemsStatus:e,orderIds:d,orderStatus:M,purchasedDate:U,siteId:h,skus:k,createdDate:L}=r;try{const{data:V}=await be({createdFrom:L[0],createdTo:L[1],siteId:h,skus:k.toString(),orderIds:d.toString(),orderStatus:M,purchasedDateFrom:U[0],purchasedDateTo:U[1],shippingType:e});C.value=E((V==null?void 0:V.orders)??[])}catch(V){$({title:"Error !",content:V},"danger")}};return ie(()=>{var r;(r=u.value)==null||r.handleSearch()}),(r,e)=>{const d=Q,M=se,U=oe,h=ne,k=J,L=ae,V=le,re=me,R=ge,de=ve,ue=qe,pe=Se,ce=Ce;return x(),P(ce,null,{default:l(()=>[n(L,{title:s(y)?"Assignment Completed":"Assign Ticket","backdrop-close":!1,visible:s(_),onClose:e[1]||(e[1]=i=>o()),onSubmit:e[2]||(e[2]=i=>g())},{footer:l(()=>[a("div",Ze,[n(k,{color:"info",variant:"outline",onClick:e[0]||(e[0]=i=>o())},{default:l(()=>e[12]||(e[12]=[m(" Close ")])),_:1}),n(k,{color:"primary",type:"submit"},{default:l(()=>[m(S(s(y)?"View Ticket":"Assign Ticket"),1)]),_:1})])]),default:l(()=>[a("div",Je,S(s(y)?"Ticket Number:":"These orders are to be assigned:"),1),s(y)?(x(!0),q(G,{key:0},ee(s(v),(i,Y)=>(x(),P(U,{key:Y,class:"mb-2"},{default:l(()=>[n(M,null,{default:l(()=>[a("div",Xe,[n(d,{class:"icon-ticket"}),m(" "+S(i),1)])]),_:2},1024)]),_:2},1024))),128)):(x(),P(h,{key:1,headers:s(D),items:s(I)},null,8,["headers","items"]))]),_:1},8,["title","visible"]),n(L,{"backdrop-close":!1,visible:s(A),title:"Cancel Order",onClose:e[4]||(e[4]=i=>o()),onSubmit:e[5]||(e[5]=i=>B(s(T)))},{footer:l(()=>[a("div",et,[n(k,{color:"info",variant:"outline",onClick:e[3]||(e[3]=i=>o())},{default:l(()=>e[13]||(e[13]=[m(" Close ")])),_:1}),n(k,{color:"danger",type:"submit"},{default:l(()=>e[14]||(e[14]=[m("Cancel Order")])),_:1})])]),default:l(()=>[e[15]||(e[15]=m(" Are you sure you want to cancel this order? "))]),_:1},8,["visible"]),a("div",tt,[a("div",st,[n(V,{modelValue:s(p),"onUpdate:modelValue":e[6]||(e[6]=i=>z(p)?p.value=i:null),"icon-left":"icon-zoom",placeholder:"Search"},null,8,["modelValue"]),n(k,{color:"dark",onClick:e[7]||(e[7]=i=>N.value=!s(N))},{icon:l(()=>[n(d,{class:"icon-filter"})]),default:l(()=>[e[16]||(e[16]=m(" Advanced Search "))]),_:1})]),a("div",ot,[a("div",nt,[n(k,{disabled:s(C).length==0,color:"info",onClick:e[8]||(e[8]=i=>b())},{default:l(()=>[m(S(s(t)?"Deselect All":"Select All"),1)]),_:1},8,["disabled"])]),n(re),n(k,{disabled:!s(I).length,class:"relative",color:"primary",onClick:e[9]||(e[9]=i=>_.value=!0)},{default:l(()=>[e[17]||(e[17]=m(" Assign Ticket ")),s(I).length?(x(),P(R,{key:0,color:"secondary",position:"top-right",rounded:""},{default:l(()=>[m(S(s(I).length),1)]),_:1})):te("",!0)]),_:1},8,["disabled"])])]),n(de,{visible:s(N)},{default:l(()=>[n(Qe,{ref_key:"refAdvancedSearch",ref:u,class:"mb-4",onClose:e[10]||(e[10]=i=>N.value=!1),onSearch:j},null,512)]),_:1},8,["visible"]),n(pe,{headers:s(w),items:s(C),"search-query":s(p),"key-field":"orderId",selectable:"",onSelectItems:f},{header:l(()=>[a("div",at,[e[19]||(e[19]=a("div",{class:"text-gray-950 text-base font-medium"},"Order List",-1)),a("div",lt,[a("div",it,[n(R,{color:"tips"}),e[18]||(e[18]=m(" Same Order "))])])])]),site:l(({item:i})=>[a("img",{src:s(F)(i.site),class:"min-w-full max-w-none!",width:"68"},null,8,rt)]),orderStatus:l(({item:i})=>[n(R,{color:s(De)(i.orderStatus)},{default:l(()=>[m(S(("formatString"in r?r.formatString:s(H))(i.orderStatus)),1)]),_:2},1032,["color"])]),shippingType:l(({item:i})=>[n(R,{color:s(Ie)(i.shippingType)},{default:l(()=>[m(S(("formatString"in r?r.formatString:s(H))(i.shippingType)),1)]),_:2},1032,["color"])]),fullName:l(({item:i})=>[m(S(i.shippingLastName)+" "+S(i.shippingFirstName),1)]),additionalPriceDetail:l(({item:i})=>[i.additionalPriceDetail?(x(!0),q(G,{key:0},ee(i.additionalPriceDetail.split(","),(Y,K)=>(x(),q("div",{key:K},S(Y),1))),128)):te("",!0)]),action:l(({item:i})=>[a("div",dt,[n(ue,{editOrder:i,disabled:i.disabled||i.orderStatus==="cancelled",onAfterSave:e[11]||(e[11]=Y=>{var K;return(K=s(u))==null?void 0:K.handleSearch()})},null,8,["editOrder","disabled"]),n(k,{disabled:i.disabled||!["onTicket","backOrder"].includes(i.shippingType),color:"danger",size:"sm",onClick:Y=>O(i)},{default:l(()=>e[20]||(e[20]=[m(" Cancel ")])),_:2},1032,["disabled","onClick"])])]),_:1},8,["headers","items","search-query"])]),_:1})}}});export{Bt as default};
