import{_ as fe}from"./4ZgsPuCv.js";import{_ as ve}from"./CZ95sRV0.js";import{_ as pe}from"./D2I4-BiG.js";import{_ as ge}from"./Dkg6wt7-.js";import{_ as ke}from"./DU82XHeJ.js";import{_ as be}from"./CzCyeDm6.js";import{e as X,c as g,o as u,a as n,t as d,F as q,g as H,b as a,M as ye,w as l,D as G,m as he,d as r,r as c,C as _e,h as Se,i as T,s as _,u as o,f as D,l as J,_ as Ie}from"./CGlOR2SB.js";import{_ as we}from"./BPIteKfo.js";import{_ as Ce}from"./DcQmg7LI.js";import{_ as Oe}from"./C4XxoYX6.js";import{_ as Te}from"./DaePeZ1q.js";import{f as F}from"./671f6edt.js";import{t as De,d as $e,s as Le,e as xe}from"./b7tXQ04B.js";import{w as Ae}from"./DJlvbE2w.js";import{b as P,o as Ee,u as Ve}from"./CjDPWaWQ.js";import{u as Be}from"./D7dddG0I.js";import{u as Me}from"./C65tmNaY.js";import{u as Pe}from"./ygeAwaRL.js";import{f as qe}from"./DkQxb8LZ.js";import"./BTARQjjd.js";const Ye={class:"grid grid-cols-2 items-center justify-items-center bg-gray-100 h-9 text-xs font-medium text-gray-800"},je=["onClick"],Ue=["for"],Ne=X({__name:"CheckBoxWithTable",props:{list:{type:Object,default:()=>({})},modelValue:{type:String,default:""},headers:{type:Array,default:()=>[]},columns:{type:Object,default:()=>({label:"label",value:"value"})}},emits:["update:modelValue"],setup(m,{emit:Y}){const j=Y,U=b=>{j("update:modelValue",b)};return(b,$)=>{const I=be;return u(),g(q,null,[n("div",Ye,[n("div",null,d(m.headers[0]||m.columns.label),1),n("div",null,d(m.headers[1]||m.columns.value),1)]),n("form",null,[n("fieldset",null,[(u(!0),g(q,null,H(m.list,(k,E)=>(u(),g("div",{key:E,class:"grid grid-cols-2 items-center justify-items-center border-dashed border-b h-[52px] hover:bg-primary4 cursor-pointer",onClick:V=>U(k[m.columns.value])},[a(I,he({ref_for:!0},b.$attrs,{id:k[m.columns.value],class:"px-6 gap-8",checked:k[m.columns.value]===m.modelValue,value:k[m.columns.value],label:k[m.columns.label],name:"group-check","onUpdate:modelValue":$[0]||($[0]=V=>b.$emit("update:modelValue",V))}),ye({_:2},[b.$slots.label?{name:"label",fn:l(()=>[G(b.$slots,"label",{item:k})]),key:"0"}:void 0]),1040,["id","checked","value","label"]),n("label",{for:k[m.columns.value]},[G(b.$slots,"value",{item:k}),r(" "+d(b.$slots.value?"":k[m.columns.value]),1)],8,Ue)],8,je))),128))])])],64)}}}),Re={class:"text-gray-800"},Ke={key:0},Qe={key:1},ze={class:"h-5"},We={class:"font-bold inline-block"},Fe={class:"list-disc ml-8"},He={key:0,class:"h-5"},Ze={key:1,class:"h-5"},Ge={key:0,class:"h-5"},Je={class:"font-bold inline-block"},Xe={key:1,class:"text-red-500 h-5"},et={class:"font-bold inline-block"},tt={class:"flex gap-2"},ot={class:"flex gap-2"},st={class:"preview-block"},lt={style:{padding:"0"}},nt={class:"flex gap-2"},rt={class:"mb-5 md:grid md:grid-cols-3"},it={class:"md:flex md:justify-between md:items-center"},at={class:"flex gap-2 text-gray-950 text-base font-medium"},dt={class:"flex gap-1"},ut=["src"],ct=X({__name:"shipment-ticket",setup(m){const{downloadZip:Y}=Be(),{generateQRCodes:j,downloadQrCodes:U}=Me();Pe({title:"Shipment Ticket"});const{getSiteImage:b}=Ve(),$=qe(new Date,"YYYY-MM-DD"),I=c([$,$]),k=c([{key:"orderId",label:"Order ID"},{key:"sku",label:"SKU"},{key:"orderStatus",label:"Order Status"},{key:"updatedAt",label:"Date"},{key:"edit",label:"Action"}]),E=c([]),V=t=>{const e=new Map;return t.forEach(s=>{const v={id:s.id,disabled:s.status==="cancelled",orderId:s.orderId,orderStatus:s.orderStatus,siteId:s.siteId,sku:s.sku,assignedStatus:s.assignedStatus,assignedItem:s.assignedItem,createdAt:s.createdAt,updatedAt:s.updatedAt,siteCode:s.siteCode};e.has(s.ticketId)?e.get(s.ticketId).orderList.push(v):e.set(s.ticketId,{id:s.id,ticketId:s.ticketId,orderList:[v]})}),Array.from(e.values())},L=async()=>{try{const{data:t}=await De({from:I.value[0],to:I.value[1]});E.value=V((t==null?void 0:t.tickets)||[])}catch(t){_({title:"Error !",content:t},"danger")}},N=c(""),R=c(!1),ee=async t=>{try{const{data:e}=await $e({ticketIds:[t]});e!=null&&e.message&&_({title:"Success !",content:e==null?void 0:e.message})}catch(e){_({title:"Error !",content:e},"danger")}finally{L()}S()},w=c(!1),K=c(!1),y=c({orderTotal:0,ukOrder:0,hkOrder:0,backOrder:0,cancelOrder:0}),B=c(""),te=t=>{const e=t.orderList;B.value=t.ticketId,K.value=!0,y.value={orderTotal:e.length,ukOrder:e.filter(s=>s.assignedStatus==="localItem").length,hkOrder:e.filter(s=>s.assignedStatus==="directLine").length,backOrder:e.filter(s=>s.assignedStatus==="noItem").length,cancelOrder:e.filter(s=>s.orderStatus==="cancel").length}},f=c({label:[],qrcode:[],detail:""}),x=c(!1),oe=async()=>{if(B.value.length!==0){x.value=!0;try{const{data:t,error:e}=await Le({ticketIds:[B.value]});if(se(t),e!=null&&e.message){_({title:"Error !",content:e==null?void 0:e.message},"danger"),S();return}t!=null&&t.message&&_({title:"Error !",content:t==null?void 0:t.message}),w.value=!0}catch(t){_({title:"Error !",content:t},"danger")}finally{x.value=!1,L()}}},se=t=>{var e;f.value={label:[],qrcode:[],detail:""},t!=null&&t.tracking&&((e=t==null?void 0:t.tracking)==null||e.forEach(s=>{f.value.label.push(s.labelUrl),s.shippingType==="directLine"&&s.skus.forEach(v=>{const M={trackingId:s.trackingCode,sku:s.skus.length>1?"":v.sku,qty:v.total,updatedDate:s.updatedAt};f.value.qrcode.push(M)})}),f.value.detail=t.details,f.value.label=[...new Set(f.value.label)])},Q=c(!1),h=c({}),C=c([]),O=c(""),le=async t=>{try{const{data:e}=await Ae({sku:t.sku,assignedTo:"pending"});(e==null?void 0:e.info.items.length)>0&&(e==null?void 0:e.info.directStock)>0&&C.value.push({sku:"Direct Line",itemId:"directLine"}),(e==null?void 0:e.info.items.length)>0&&(C.value=C.value.concat(e==null?void 0:e.info.items),O.value=t.assignedItem||"directLine")}catch(e){_({title:"Error !",content:e},"danger")}h.value=t,Q.value=!0},ne=async()=>{if(!(!h.value.id||!O.value))try{const{data:t,error:e}=await xe({id:h.value.id,itemId:O.value});e!=null&&e.message&&_({title:"Error !",content:e.message},"warning"),t!=null&&t.message&&_({title:"Success !",content:t==null?void 0:t.message})}catch(t){_({title:"Error !",content:t},"danger")}finally{S(),L()}},S=()=>{R.value=!1,N.value="",K.value=!1,Q.value=!1,C.value=[],w.value=!1,B.value="",x.value=!1},re=t=>Object.keys(t).length,ie=async()=>{f.value.label.length&&await Y(f.value.label,"labels.zip")},ae=async()=>{f.value.qrcode.length&&(await j(f.value.qrcode),U())};return _e(I,L),Se(()=>{L()}),(t,e)=>{const s=fe,v=ve,M=pe,z=ge,A=ke,de=Ne,ue=we,Z=Ce,ce=Oe,me=Te;return u(),T(me,null,{default:l(()=>[a(z,{title:o(w)?"Ship Result ":"Confirm before ship","backdrop-close":!1,visible:o(K),onClose:e[1]||(e[1]=i=>!o(x)&&S())},{footer:l(()=>[n("div",tt,[a(v,{variant:"outline",color:"info",onClick:e[0]||(e[0]=i=>!o(x)&&S())},{default:l(()=>e[13]||(e[13]=[r(" Close ")])),_:1}),a(M,{size:"md",icon:o(w)?"icon-download":"","loading-click":()=>o(w)?ie():oe()},{default:l(()=>[r(d(o(w)?"Download Label":"Ship Ticket"),1)]),_:1},8,["icon","loading-click"]),o(w)&&o(f).qrcode.length!==0?(u(),T(M,{key:0,color:"primary",variant:"outline",icon:"icon-qrcode","loading-click":ae},{default:l(()=>e[14]||(e[14]=[r(" Download QRcode ")])),_:1})):D("",!0)])]),default:l(()=>[n("div",Re,[o(w)?(u(),g("div",Ke,[r(" There are "+d(o(f).label.length)+" orders ready to ship. You can also download label from the shipment list. ",1),a(s,{color:"danger",visible:o(f).detail.length!==0},{default:l(()=>[(u(!0),g(q,null,H(o(f).detail,(i,W)=>(u(),g("span",{key:W},d(i),1))),128))]),_:1},8,["visible"])])):(u(),g("ul",Qe,[n("li",ze,[n("div",We,d(o(y).orderTotal),1),e[10]||(e[10]=r(" orders are ready to ship : "))]),n("ul",Fe,[o(y).ukOrder?(u(),g("li",He,d(o(y).ukOrder)+" orders will be shipped from UK warehouse ",1)):D("",!0),o(y).hkOrder?(u(),g("li",Ze,d(o(y).hkOrder)+" orders will be shipped from HK warehouse ",1)):D("",!0)]),o(y).backOrder?(u(),g("li",Ge,[n("div",Je,d(o(y).backOrder),1),e[11]||(e[11]=r(" order will be placed on back order due to no matching items "))])):D("",!0),o(y).cancelOrder?(u(),g("li",Xe,[n("div",et,d(o(y).cancelOrder),1),e[12]||(e[12]=r(" order is canceled before shipping "))])):D("",!0)]))])]),_:1},8,["title","visible"]),a(z,{title:"Delete Ticket","backdrop-close":!1,visible:o(R),onClose:e[3]||(e[3]=i=>S()),onSubmit:e[4]||(e[4]=i=>ee(o(N)))},{footer:l(()=>[n("div",ot,[a(v,{variant:"outline",color:"info",onClick:e[2]||(e[2]=i=>S())},{default:l(()=>e[15]||(e[15]=[r(" Cancel ")])),_:1}),a(v,{color:"danger",type:"submit"},{default:l(()=>e[16]||(e[16]=[r("Delete Ticket")])),_:1})])]),default:l(()=>[e[17]||(e[17]=r(" The order status of all orders in this ticket will be changed to Pending. "))]),_:1},8,["visible"]),a(z,{size:"lg",title:"Order Detail","backdrop-close":!1,visible:o(Q),onClose:e[7]||(e[7]=i=>S()),onSubmit:e[8]||(e[8]=i=>ne())},{footer:l(()=>[n("div",nt,[a(v,{variant:"outline",color:"info",onClick:e[6]||(e[6]=i=>S())},{default:l(()=>e[25]||(e[25]=[r(" Close ")])),_:1}),a(v,{color:"success",type:"submit"},{default:l(()=>e[26]||(e[26]=[r("Save Changes")])),_:1})])]),default:l(()=>[n("div",st,[e[18]||(e[18]=n("div",null,"Order ID",-1)),n("div",null,d(o(h).orderId),1),e[19]||(e[19]=n("div",null,"SKU",-1)),n("div",null,d(o(h).sku),1),e[20]||(e[20]=n("div",null,"Date",-1)),n("div",null,d(o(h).updatedAt),1),e[21]||(e[21]=n("div",null,"Item Status",-1)),n("div",lt,[a(A,{style:{"background-color":"#ffffff"},color:o(P)(o(h).assignedStatus)},{default:l(()=>[r(d(("formatString"in t?t.formatString:o(F))(o(h).assignedStatus))+" "+d(o(h).assignedStatus==="returnItem"?o(h).assignedItem:""),1)]),_:1},8,["color"])])]),re(o(C))?(u(),T(de,{key:0,modelValue:o(O),"onUpdate:modelValue":e[5]||(e[5]=i=>J(O)?O.value=i:null),list:o(C),headers:["Warehouse Status","Item ID"],columns:{label:"itemId",value:"itemId"},type:"radio"},{label:l(({item:i})=>[i.itemId=="directLine"?(u(),T(A,{key:0,color:o(P)("directLine")},{default:l(()=>e[22]||(e[22]=[r(" Direct Line ")])),_:1},8,["color"])):(u(),T(A,{key:1,color:o(P)("localItem")},{default:l(()=>e[23]||(e[23]=[r(" Local Item ")])),_:1},8,["color"]))]),value:l(({item:i})=>[r(d(i.itemId!=="directLine"?i.itemId:""),1)]),_:1},8,["modelValue","list"])):D("",!0),a(s,{color:"primary",visible:!0},{default:l(()=>e[24]||(e[24]=[r(" If you want to select an item that has already been selected, please reassign the ticket. ")])),_:1})]),_:1},8,["visible"]),n("div",rt,[a(ue,{modelValue:o(I),"onUpdate:modelValue":e[9]||(e[9]=i=>J(I)?I.value=i:null),"value-type":"YYYY-MM-DD",class:"md:m-0 mb-2"},null,8,["modelValue"])]),(u(!0),g(q,null,H(o(E),(i,W)=>(u(),T(ce,{key:W,headers:o(k),class:"mb-4",items:i.orderList,pagination:!1},{header:l(()=>[n("div",it,[n("div",at,[a(Z,{class:"icon-ticket"}),r(" "+d(i.ticketId),1)]),n("div",dt,[a(v,{color:"danger",onClick:p=>(R.value=!0,N.value=i.ticketId)},{default:l(()=>e[27]||(e[27]=[r(" Delete Ticket ")])),_:2},1032,["onClick"]),a(v,{color:"primary",onClick:p=>te(i)},{default:l(()=>e[28]||(e[28]=[r(" Ship Ticket ")])),_:2},1032,["onClick"])])])]),siteId:l(({item:p})=>[n("img",{src:o(b)(p.siteId),width:"68"},null,8,ut)]),orderStatus:l(({item:p})=>[a(A,{color:o(Ee)(p.orderStatus)},{default:l(()=>[r(d(("formatString"in t?t.formatString:o(F))(p.orderStatus)),1)]),_:2},1032,["color"])]),assignedStatus:l(({item:p})=>[a(A,{color:o(P)(p.assignedStatus)},{default:l(()=>[r(d(("formatString"in t?t.formatString:o(F))(p.assignedStatus))+" "+d(p.assignedStatus==="localItem"?`: ${p.assignedItem}`:""),1)]),_:2},1032,["color"])]),edit:l(({item:p})=>[a(v,{color:"info",variant:"outline",disabled:p.disabled,onClick:mt=>le(p)},{icon:l(()=>[a(Z,{class:"icon-edit"})]),default:l(()=>[e[29]||(e[29]=r(" Edit "))]),_:2},1032,["disabled","onClick"])]),_:2},1032,["headers","items"]))),128))]),_:1})}}}),Et=Ie(ct,[["__scopeId","data-v-9a264b82"]]);export{Et as default};
